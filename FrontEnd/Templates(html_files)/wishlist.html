<!--Javascript code for database is in the middle of the code-->
<!--JavaScript code detailed below!-->
<!DOCTYPE html>
<html>

<head>

<!-- meta tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Include Javascript and stylesheet files-->
<script src="/JavaScriptFiles/home_page.js"></script>


<!-- include stylesheet -->
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="	https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Work+Sans&display=swap" rel="stylesheet">
<div class="topnav">

<div class="logo"><img src="/Static(images)/Library_Assistant_Logo.png" class="w3-round w3-image" 
  alt="book_logo" width="270" height="50" ><b><i> </i></b></div>
<div class=menu>
<nav class="navbar navbar-expand-lg p-0" style="display: block;">

   
             <!-- Other html files options on the home page--> 

             <a href="/Templates\(html_files\)/home_page.html">Home</a> 
             <a href="/Templates(html_files)/about_us.html">About us</a>
             <a href="/Templates(html_files)/feedback.html">Contact Us</a>
  </nav>
  </div>
  </div>


             <!-- start of body -->
            

  
                <!-- The 2 big boxes options on the home page-->

    
  <!-- <div class="square"></div> -->

  <!--*****************************************************************************************8-->
<!--Javascript code to access database information-->
    <script>
      //Code includes functions:

      //Wishlist:
      //sendData()
      //onDeleteButtonClick(constant)
      //onInsertIntoWishlistClick(constant)

      //Checked Out In:
      //getCheckOut_In()
      //onCheckOutButtonClick(constant)

      //CreateUser:
      //getLargestID(callback)
      //createUser()

      //Login:
      //login()

      //***********************************************************************8
      //WISHLIST FUNCTIONS!!!
      //function to get wishlist data and display in a table:
      function sendData() {
        var xhr = new XMLHttpRequest();
        //Runs the script:
        xhr.open("GET", "http://localhost:3000/wishlist", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.onreadystatechange = function () {
          //Checks the request:
          if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
              //Response from the function:
              var response = xhr.response;
              //Parses the response as it is originally a string but needs to become the returned list from the database:
              var response = JSON.parse(response)
              //Displays in a table:
              var table = '<table><tr><th>Number</th><th>BookID</th><th>Delete</th></tr>';
              for (var i = 0; i < response.length; i++) {
                        //logs the row as a test:
                        console.log(response[i]);
                        //Displays isbn and id:
                        table += '<tr><td>' + (i + 1) + '</td><td>' + response[i].bookid + '</td>' + '<td><button onclick="onDeleteButtonClick(\'' + response[i].bookid + '\')">Delete</button></td></tr>';
                    }
                    table += '</table>';
                    document.getElementById("result").innerHTML = table;
            } else {
                console.error('Failed to make POST request:', xhr.status);
            }
          }
        };
        xhr.send(/* payload */);
      };

      //Code for deleting a wishlist item on a button click:
      function onDeleteButtonClick(constant) {
        alert("Deleting book: " + constant);
        //Gets user typed values:
        var book = constant
        var id = '0001'
        console.log(constant);
        //Generates id:
        var xhr = new XMLHttpRequest();
        //Runs the script:
        xhr.open("POST", "http://localhost:3000/deleteFromWishlist", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        //Set payload and send in string format:
        var payload = ({ bookID: book, ID: id });
        xhr.send(JSON.stringify( payload ));
        console.log(JSON.stringify(payload));
        xhr.onreadystatechange = function() {
          //Checks the request:
          if (xhr.readyState === XMLHttpRequest.DONE) {
            //Success:
            if (xhr.status === 200) {
              console.log("Deleted");
            } else {
              //Failure:
              console.error('Failed to make POST request:', xhr.status);
            }
          };
        };
        sendData()
      };


      //Puts a book into the wishlist on the click of a button:
      function onInsertIntoWishlistClick(constant) {
        alert("Inserting book: " + constant);
        //Gets user typed values:
        var book = constant
        var id = '0001'
        console.log(constant);
        //Generates id:
        var xhr = new XMLHttpRequest();
        //Runs the script:
        xhr.open("POST", "http://localhost:3000/insertWishlistBook", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        //Set payload and send in string format:
        var payload = ({ bookID: book, ID: id });
        xhr.send(JSON.stringify( payload ));
        console.log(JSON.stringify(payload));
        xhr.onreadystatechange = function() {
          //Checks the request:
          if (xhr.readyState === XMLHttpRequest.DONE) {
            //Success:
            if (xhr.status === 200) {
              console.log("Deleted");
            } else {
              //Failure:
              console.error('Failed to make POST request:', xhr.status);
            }
          };
        };
        sendData()
      };

      //***************************************************
      //CHECKED OUT IN FUNCTIONS!!!
      //Creates a table for checked out and checked in books:
      function getCheckOut_In() {
        var xhr = new XMLHttpRequest();
        //Runs the script:
        xhr.open("GET", "http://localhost:3000/checked", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.onreadystatechange = function () {
          //Checks the request:
          if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
              //Response from the function:
              var response = xhr.response;
              //Parses the response as it is originally a string but needs to become the returned list from the database:
              var response = JSON.parse(response)
              //Displays in a table:
              var table = '<table><tr><th>Number</th><th>BookID</th><th>Return Date</th><th>Checked Out</th></tr>';
              for (var i = 0; i < response.length; i++) {
                        //logs the row as a test:
                        console.log(response[i]);
                        //Displays isbn and id:
                        table += '<tr><td>' + (i + 1) + '</td><td>' + response[i].bookid + '</td><td>' + response[i].return_date.substr(0,10) + '</td><td>' + response[i].check_in + '</td></tr>';
                    }
                    table += '</table>';
                    document.getElementById("result").innerHTML = table;
            } else {
                console.error('Failed to make POST request:', xhr.status);
            }
          }
        };
        xhr.send(/* payload */);
      };

      //Function to insert a book into checked_out_in as a checked out book on a button click:
      function onCheckOutButtonClick(constant) {
        alert("Checking Out Book: " + constant);
        //Gets user typed values:
        var book = constant
        var id = '0001'
        console.log(constant);
        var xhr = new XMLHttpRequest();
        //Runs the script:
        xhr.open("POST", "http://localhost:3000/checkOut", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        //Set payload and send in string format:
        var payload = ({ id: id, bookID: book });
        xhr.send(JSON.stringify( payload ));
        console.log(JSON.stringify(payload));
        xhr.onreadystatechange = function() {
          //Checks the request:
          if (xhr.readyState === XMLHttpRequest.DONE) {
            //Success:
            if (xhr.status === 200) {
              console.log("Checked Out Book");
            } else {
              //Failure:
              console.error('Failed to make POST request:', xhr.status);
            }
          };
        };
        sendData()
      };


      //*****************************************************************8
      ///CREATEUSER FUNCTIONS!!!
      //Javascript code for getting maximum id and returning the next one:
      function getLargestID(callback) {
        var id = "0000"
        var xhr = new XMLHttpRequest();
        //Runs the script:
        xhr.open("GET", "http://localhost:3000/getNextID", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.onreadystatechange = function () {
          //Checks the request:
          if (xhr.readyState === XMLHttpRequest.DONE) {
              if (xhr.status === 200) {
                //Parse the response:
                response = JSON.parse(xhr.response);
                response = parseInt(response[0].max) + 1
                //Insert any 0's:
                while (response.toString().length < 4) {
                    response = "0" + response.toString();
                };
                id = response;
                //Return the id:
                callback(id);
              } else {
                  console.error('Failed to make POST request:', xhr.status);
              }
          };
        };
        xhr.send();
      };

      //Creates a user with the next id using form answers:
      function createUser() {
        //Gets user typed values:
        var email = document.getElementById("email").value;
        var username = document.getElementById("username").value;
        var password = document.getElementById("password").value;
        var id = "0000";
        //Generates id:
        getLargestID(function(id) {
          console.log(id);
          var xhr = new XMLHttpRequest();
          //Runs the script:
          xhr.open("POST", "http://localhost:3000/createUser", true);
          xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
          //Set payload and send in string format:
          var payload = ({ email: email, username: username, password: password, id:id });
          xhr.send(JSON.stringify( payload ));
          xhr.onreadystatechange = function() {
            //Checks the request:
            if (xhr.readyState === XMLHttpRequest.DONE) {
              //Success:
              if (xhr.status === 200) {
                console.log("Inserted");
              } else {
                //Failure:
                console.error('Failed to make POST request:', xhr.status);
              }
            }
          };  
        });
      };

      //*************************************************8
      //LOGIN FUNCTIONS:
      //Logins a user:
      function login() {
      //Gets user typed values:
        var username2 = document.getElementById("username2").value;
        var password2 = document.getElementById("password2").value;
        console.log(username2 + password2);
        //Generates id:
        var xhr = new XMLHttpRequest();
        //Runs the script:
        xhr.open("POST", "http://localhost:3000/loginUser", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        //Set payload and send in string format:
        var payload = ({ username: username2, password: password2 });
        xhr.send(JSON.stringify( payload ));
        console.log(JSON.stringify(payload));
        xhr.onreadystatechange = function() {
          //Checks the request:
          if (xhr.readyState === XMLHttpRequest.DONE) {
            //Success:
            if (xhr.status === 200) {
              console.log("Logged In");
            } else {
              //Failure:
              console.error('Failed to make POST request:', xhr.status);
            }
          };
        };
      };

      


      
    

      
  </script>
</head>



<body>
  <body style="background-color: #102951;"></body>
<h3 style="color: white">Wishlist</h3>
<h1>Sign Up</h1>
  <form>
    <label for="email">Email:</label>
    <input type="text" id="email" name="email">
    <br>
    <label for="username">Username:</label>
    <input type="text" id="username" name="username">
    <br>
    <label for="password">Password:</label>
    <input type="password" id="password" name="password">
    <br>
    <button type="button" onclick="createUser()">Login</button>
  </form>
  <h1>Login</h1>
  <form>
    <label for="username2">Username:</label>
    <input type="text" id="username2" name="username2">
    <br>
    <label for="password2">Password:</label>
    <input type="text" id="password2" name="password2">
    <br>
    <button type="button" onclick="login()">Login</button>
  </form>


    <!--***************************************************************************************-->
    <!--CODE FOR DISPLAYING THE JAVASCRIPT DATABASE!!!!!!!!!!!!!-->
    <body onload="getCheckOut_In()">
      <!--Displays the variable result from the javascript-->
      <div style="color: white" id="result"></div>
  </body>
</body>
<!-- end of body -->

</html>