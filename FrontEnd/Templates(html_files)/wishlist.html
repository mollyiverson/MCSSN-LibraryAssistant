<!--Javascript code for database is in the middle of the code-->

<!DOCTYPE html>
<html>

<head>

    <!-- meta tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Title of Website -->
    <title> LIBRARY ASSISTANT </title>

    <script src="/FrontEnd/JavaScriptFiles/wishlist.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- include stylesheet -->
    <link rel="stylesheet" href="/FrontEnd/Styles(css_files)/wishlist.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Bar -->
    <div class="topnav">
        <div class="logo"><img src="/FrontEnd/Static(images)/Library_Assistant_Logo.png" class="w3-round w3-image"
                alt="book_logo" width="270" height="50"><b><i> </i></b></div>
        <div class=menu>
            <nav class="navbar navbar-expand-lg p-0" style="display: block;">

                <div class="navbar">
                    <a href="/FrontEnd/Templates(html_files)/search.html">Search</a>
                    <a href="/FrontEnd/Templates(html_files)/quiz.html">Quiz</a>

                    <i class="fa fa-user-circle-o" style="font-size:30px; color:rgb(207, 223, 226)"> </i>
                </div>

            </nav>
        </div>
    </div>
    
<!--Javascript code to access database information-->
    <script>
      function sendData() {
        var xhr = new XMLHttpRequest();
        //Runs the script:
        xhr.open("GET", "http://localhost:3000/wishlist", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.onreadystatechange = function () {
          //Checks the request:
          if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
              //Response from the function:
              var response = xhr.response;
              //Parses the response as it is originally a string but needs to become the returned list from the database:
              var response = JSON.parse(response)
              //Displays in a table:
              var table = '<table><tr><th>BookID</th><th>ID</th></tr>';
              for (var i = 0; i < response.length; i++) {
                        //logs the row as a test:
                        console.log(response[i]);
                        //Displays isbn and id:
                        table += '<tr><td>' + response[i].bookid + '</td><td>' + response[i].id + '</td></tr>';
                    }
                    table += '</table>';
                    document.getElementById("result").innerHTML = table;
            } else {
                console.error('Failed to make POST request:', xhr.status);
            }
          }
        };
        xhr.send(/* payload */);
      };


      //Javascript code for getting maximum id and returning the next one:
      function getID(callback) {
        var id = "0000"
        var xhr = new XMLHttpRequest();
        //Runs the script:
        xhr.open("GET", "http://localhost:3000/getNextID", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.onreadystatechange = function () {
          //Checks the request:
          if (xhr.readyState === XMLHttpRequest.DONE) {
              if (xhr.status === 200) {
                //Parse the response:
                response = JSON.parse(xhr.response);
                response = parseInt(response[0].max) + 1
                //Insert any 0's:
                while (response.toString().length < 4) {
                    response = "0" + response.toString();
                };
                id = response;
                //Return the id:
                callback(id);
              } else {
                  console.error('Failed to make POST request:', xhr.status);
              }
          };
        };
        xhr.send();
      };

      //Creates a user with the next id using form answers:
      function createUser() {
        //Gets user typed values:
        var email = document.getElementById("email").value;
        var username = document.getElementById("username").value;
        var password = document.getElementById("password").value;
        var id = "0000";
        //Generates id:
        getID(function(id) {
          console.log(id);
          var xhr = new XMLHttpRequest();
          //Runs the script:
          xhr.open("POST", "http://localhost:3000/createUser", true);
          xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
          //Set payload and send in string format:
          var payload = ({ email: email, username: username, password: password, id:id });
          xhr.send(JSON.stringify( payload ));
          xhr.onreadystatechange = function() {
            //Checks the request:
            if (xhr.readyState === XMLHttpRequest.DONE) {
              //Success:
              if (xhr.status === 200) {
                console.log("Inserted");
              } else {
                //Failure:
                console.error('Failed to make POST request:', xhr.status);
              }
            }
          };  
        });
      };

      function login() {
      //Gets user typed values:
        var username2 = document.getElementById("username2").value;
        var password2 = document.getElementById("password2").value;
        console.log(username2 + password2);
        //Generates id:
        var xhr = new XMLHttpRequest();
        //Runs the script:
        xhr.open("POST", "http://localhost:3000/loginUser", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        //Set payload and send in string format:
        var payload = ({ username: username2, password: password2 });
        xhr.send(JSON.stringify( payload ));
        console.log(JSON.stringify(payload));
        xhr.onreadystatechange = function() {
          //Checks the request:
          if (xhr.readyState === XMLHttpRequest.DONE) {
            //Success:
            if (xhr.status === 200) {
              console.log("Logged In");
              //var response = xhr.response;
              //Parses the response as it is originally a string but needs to become the returned list from the database:
              //var response = JSON.parse(response);
              //console.log(response[0].id);
            } else {
              //Failure:
              console.error('Failed to make POST request:', xhr.status);
            }
          };
        };
      };
  </script>
</head>



<body>

  <body style="background-color: #4d597e;">

    <div class="container">

        <div class="sidebar">
            <br>
            <div class="sidebar-container" id="myissues-container">
                <a href="/FrontEnd/Templates(html_files)/checkedout.html"> <i class="fa fa-bandcamp"></i>My
                    issues</a>
            </div>
            <br>
            <br>
            <div class="sidebar-container" id="wishlist-container">
                <a href="/FrontEnd/Templates(html_files)/wishlist.html"> <i class="fa fa-bookmark"></i>Wishlist </a>
            </div>
            <br>
            <br>
            <div class="sidebar-container" id="checkIn-container">
                <a href="/FrontEnd/Templates(html_files)/checkIn.html"> <i class="fa fa-calendar-check-o"></i>Check In</a>
            </div>
            <br>
            <br>
            <div class="sidebar-container" id="profile-container">
                <a href="/FrontEnd/Templates(html_files)/userProfile.html"> <i class="fa fa-user-o"></i>Profile</a>
            </div>
            <br>
            <br>
            <div class="sidebar-container" id="logout-container">
                <a href="/FrontEnd/Templates(html_files)/home_page.html"> <i class="fa fa-arrow-circle-left"></i>Log
                    Out</a>
            </div>
        </div>

        <div class="book-list">
            <div id="list-output" class=""></div>
        </div>

        

    </div>

    <div id="pagination-wrapper" class="pagination-wrapper">
        <i class="fa fa-solid fa-angle-left" onclick="previousPage()" id="prev-btn"></i>
    
  
        <i class="fa fa-solid fa-circle" onclick="reset()" id="reset-btn"></i>
  
    
        <i class="fa fa-solid fa-angle-right" onclick="nextPage()" id="next-btn"></i>
    </div>
</body>
<!-- end of body -->

</html>